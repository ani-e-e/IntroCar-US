# IntroCar US Website - Handoff Document
**Date:** January 27, 2026
**Last Session:** January 26, 2026

---

## Project Overview

**Site:** IntroCar US E-commerce Website (Next.js on Vercel)
**GitHub:** https://github.com/ani-e-e/IntroCar-US
**Live URL:** https://intro-car-us.vercel.app
**Supabase:** https://bmarqxcyyiyatkhlwkgm.supabase.co

### Architecture
- **Frontend:** Next.js 14 (App Router) on Vercel
- **Database:** Supabase PostgreSQL
- **Data Flow:** Supabase → JSON export → Git → Vercel deployment → Site reads JSON
- **Admin:** Internal admin pages write directly to Supabase

### Key Data
- **Products:** 79,080 SKUs in Supabase
- **T2 Chassis Master:** 581,354 records (vehicle fitment data)
- **Technical Videos:** 48 videos, 7 categories (now in Supabase)
- **Catalogues:** PDF catalogues organized by model

---

## Completed Work (January 26, 2026)

### 1. Chassis Lookup Feature ✅
- **API:** `/api/chassis-lookup/route.js` - Queries T2 data with 24-hour caching
- **Modes:** Lookup by chassis, validate chassis for model, get chassis list
- **UI:** "Know Your Chassis Number?" button on homepage Vehicle Finder
- **Supports:** Alphanumeric chassis codes (e.g., "ALB36", "B2AK")

### 2. T3 Fitment Validation API ✅
- **API:** `/api/fitment-validate/route.js`
- **POST:** Validates chassis ranges against T2 data
- **GET:** Returns valid chassis list for make/model
- **Ready for:** T3 SKU data import/validation

### 3. Videos Admin → Supabase ✅
- **Updated:** `/api/admin/videos/route.js` and `[id]/route.js`
- **Migrated:** 48 videos + 7 categories to Supabase `technical_videos` table
- **Schema:** Added `makes`, `models`, `product_categories` TEXT[] columns

### 4. Technical Videos Page ✅
- **Updated:** `app/technical/page.js`
- **Filters:** Now shows product categories from actual video data
- **Groups:** Videos by assigned product category

### 5. Documentation ✅
- **Created:** `docs/DATABASE-CLEANUP-2026-01-26.md`
- **Created:** `docs/SESSION-SUMMARY-2026-01-26-B.md`

---

## Priority Tasks (Next Session)

### Task 1: Add Catalogues to "Shop by Model" Results

**Goal:** When browsing Shop by Model, customers see both parts AND catalogues in results, with ability to filter/toggle between them.

**Requirements:**
- Catalogue results displayed alongside parts results
- Filter/toggle to show: All | Parts Only | Catalogues Only
- Different display card for catalogues (no price, PDF download link)
- Differentiates from "Vehicle Part Finder" (parts only) and "Shop by Catalogue" (catalogues only)

**Files to modify:**
- `app/shop/[make]/[model]/page.js` - Add catalogue fetching and display
- `components/ProductCard.js` - May need variant for catalogue display
- Create `components/CatalogueCard.js` - No price, PDF icon, download link
- `lib/data-server.js` - Add `getCataloguesForModel()` function

**Catalogue data location:** Check `data/json/catalogues.json` or Supabase `catalogues` table

**Display differences:**
| Field | Product | Catalogue |
|-------|---------|-----------|
| Price | ✅ Show | ❌ Hide |
| Add to Cart | ✅ Show | ❌ Hide |
| Download | ❌ Hide | ✅ PDF link |
| Image | Product image | Catalogue cover |

---

### Task 2: Reseller "Light" Sites (4 total)

**Goal:** Create lightweight versions of the site for international resellers with:
- Smaller SKU subset (flagged products)
- Custom color schemes matching reseller branding
- Simplified ordering (email to reseller, no webhooks)
- Same core functionality, stripped features

**Reference site:** https://albersrb.com/ (for color scheme inspiration)

**Recommended Approach:**

#### Option A: Multi-tenant Single Codebase (Recommended)
```
/app
  /[tenant]/          # Dynamic route for reseller sites
    /layout.js        # Tenant-specific theme
    /page.js          # Homepage
    /products/...
/lib
  /tenants.js         # Tenant configuration
  /theme.js           # Theme utilities
```

**Tenant Configuration:**
```javascript
// lib/tenants.js
export const tenants = {
  'introcar-us': {
    name: 'IntroCar US',
    domain: 'intro-car-us.vercel.app',
    colors: { primary: '#1e3a5f', accent: '#c9a227' },
    skuFilter: null, // All SKUs
    orderEmail: null, // Use webhooks
    features: ['full']
  },
  'albers-rb': {
    name: 'Albers RB',
    domain: 'albers.introcar.com',
    colors: { primary: '#8B0000', accent: '#FFD700' }, // From albersrb.com
    skuFilter: 'reseller_albers', // Flag in products table
    orderEmail: 'orders@albersrb.com',
    features: ['light']
  },
  // ... 3 more resellers
};
```

**Database changes:**
- Add `reseller_flags` TEXT[] column to products table
- Flag products for each reseller: `['albers', 'reseller2', ...]`
- Or use `available_regions` if already exists

**Order flow for light sites:**
```javascript
// Instead of webhook:
if (tenant.orderEmail) {
  await sendOrderEmail({
    to: tenant.orderEmail,
    order: orderDetails,
    customer: customerInfo
  });
}
```

#### Option B: Separate Deployments
- Fork repo for each reseller
- Maintain separately
- **Not recommended:** Harder to maintain, updates don't propagate

#### Implementation Steps:
1. **Phase 1:** Set up tenant configuration system
2. **Phase 2:** Create theme switching based on tenant
3. **Phase 3:** Add SKU filtering by reseller flag
4. **Phase 4:** Implement email-based ordering
5. **Phase 5:** Deploy to custom domains

---

### Task 3: Products Admin → Supabase (Carry-over)

**Goal:** Migrate products admin to write directly to Supabase (like videos admin)

**Files to update:**
- `app/api/admin/products/route.js`
- `app/api/admin/products/[id]/route.js`

---

### Task 4: Database Cleanup (Carry-over)

**Reference:** `docs/DATABASE-CLEANUP-2026-01-26.md`

**Actions needed:**
- Review and remove test data
- Consolidate duplicate tables
- Set up automated JSON export workflow

---

### Task 5: T3 Fitment Data Import (Carry-over)

**Status:** Validation API ready, needs actual data import
**API:** `/api/fitment-validate` ready for use

---

## File Reference

### Key Files Modified This Session
```
app/api/chassis-lookup/route.js      # NEW - Chassis lookup API
app/api/fitment-validate/route.js    # NEW - T3 validation API
app/api/admin/videos/route.js        # MODIFIED - Supabase integration
app/api/admin/videos/[id]/route.js   # MODIFIED - Supabase integration
app/technical/page.js                # MODIFIED - Product category filters
components/VehicleFinder.js          # MODIFIED - Chassis lookup toggle
scripts/migrate-videos-schema.sql    # NEW - DB migration
scripts/import-videos-to-supabase.js # NEW - Data import script
docs/DATABASE-CLEANUP-2026-01-26.md  # NEW - Cleanup documentation
```

### Database Tables
```
products              # 79,080 SKUs
t2_chassis_master     # 581,354 fitment records
technical_videos      # 48 videos (now with array columns)
video_categories      # 7 categories
catalogues            # PDF catalogues by model
```

---

## Environment Variables Needed

```env
NEXT_PUBLIC_SUPABASE_URL=https://bmarqxcyyiyatkhlwkgm.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
SUPABASE_SERVICE_ROLE_KEY=...
```

---

## Quick Commands

```bash
# Local development
npm run dev

# Build test
npm run build

# Run Supabase migration
# (Copy SQL to Supabase Dashboard → SQL Editor)

# Import videos to Supabase
node scripts/import-videos-to-supabase.js
```

---

## Questions for Next Session

1. **Catalogues:** Where is catalogue data stored? (JSON file or Supabase table?)
2. **Reseller SKUs:** How should products be flagged? (New column or existing field?)
3. **Reseller list:** What are the 4 resellers and their branding requirements?
4. **Domains:** Will reseller sites have custom domains or subdomains?

---

## Notes

- Git lock files may appear occasionally - remove with `rm -f .git/*.lock`
- T2 data uses alphanumeric chassis codes (not just numeric)
- Videos now read from JSON but admin writes to Supabase - need JSON export workflow
